name: Docker Image CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build the Docker image
        run: |
          docker build . -t genotek -f Dockerfile
          docker save genotek | gzip > genotek.tgz

      # - name: Login to Yandex Cloud Container Registry
      #   id: login-cr
      #   uses: yc-actions/yc-cr-login@v1
      #   with:
      #     yc-sa-json-credentials: ${{ secrets.YC_SA_JSON_CREDENTIALS }}

      # - name: Build, tag, and push image to Yandex Cloud Container Registry
      #   run: |
      #     docker build -t cr.yandex/${{ env.YC_CR_REGISTRY }}/${{ env.YC_CR_REPOSITORY }}:$IMAGE_TAG .
      #     docker push cr.yandex/${{ env.YC_CR_REGISTRY }}/${{ env.YC_CR_REPOSITORY }}:$IMAGE_TAG

      # - name: Deploy COI VM
      #   id: deploy-coi
      #   uses: yc-actions/yc-coi-deploy@v2
      #   with:
      #     yc-sa-json-credentials: ${{ secrets.YC_SA_JSON_CREDENTIALS }}
      #     folder-id: ${{ env.YC_FOLDER_ID }}
      #     vm-name: ${{ env.YC_VM_NAME }}
      #     vm-service-account-id: ${{ env.YC_VM_SERVICE_ACCOUNT_ID }}
      #     vm-cores: 2
      #     vm-memory: 2Gb
      #     vm-core-fraction: 100
      #     vm-subnet-id: ${{ env.YC_VM_SUBNET_ID }}
      #     user-data-path: "./user-data.yaml"
      #     docker-compose-path: "./docker-compose.yaml"
